<!DOCTYPE html>
<html>
    <head>
        <title>VisualForce Bootstrap Page with OAuth Plugin</title>
        
        
        <script type="text/javascript" src="phonegap-1.2.0.js"></script>
        <script type="text/javascript" src="jquery/jquery-1.6.2.min.js"></script>

        <!-- include local utility functionality -->
        <link rel="stylesheet" type="text/css" href="SFUtility.css" />
        <script type="text/javascript" charset="utf-8" src="SFUtility.js"></script>

        <script type="text/javascript" src="SalesforceOAuthPlugin.js"></script>
        
        <script type="text/javascript" src="bootconfig.js"></script>
        
        <script type="text/javascript">
        
        /**
         * JQuery's "ready" function.  This will execute once JQuery is successfully loaded.
         */
        $(function() {
            logToConsole("jQuery is ready");
            document.addEventListener("deviceready", onDeviceReady,false);
            logToConsole("Added onDeviceReady event listener.");
        });
        
        /**
         * Handler for PhoneGap's "deviceready" event, signifying that PhoneGap is successfully
         * loaded.
         */
        function onDeviceReady() {
            logToConsole("onDeviceReady called: PhoneGap is ready.");
            
            // Authenticate via the Salesforce OAuth plugin.
            var oauthProperties = new OAuthProperties(remoteAccessConsumerKey, 
                                                      oauthRedirectURI, 
                                                      oauthScopes, 
                                                      autoRefreshOnForeground);
            SalesforceOAuthPlugin.authenticate(loginSuccess, loginFailure, oauthProperties);
        }
            
        /**
         * Success callback for the SalesforceOAuthPlugin.authenticate() method.
         */
        function loginSuccess(oauthCredentials) {
            logToConsole("loginSuccess");
            var fullAppUrl;
            if (startPage == "") {
                fullAppUrl =  SalesforceOAuthPlugin.buildDefaultLocalUrl();
            } else {
                fullAppUrl = SalesforceOAuthPlugin.buildAppUrl(startPage, oauthCredentials);
            }
            logToConsole("fullAppUrl: " + fullAppUrl);
            SalesforceOAuthPlugin.loadUrl(fullAppUrl);
        }
            
        /**
         * Error callback for the SalesforceOAuthPlugin.authenticate() method.
         * TODO: Is there more that we'd want to do here?
         */
        function loginFailure(result) {
            logError("loginFailure: " + result);
        }
            
        </script>
    </head>
    <body>
        <div id="main">
            <h1>Loading...</h1>
            <fieldset id="errors" class="logWindow">
                <legend>Errors</legend>
            </fieldset>
            <fieldset id="console" class="logWindow">
                <legend>Debug Console</legend>
            </fieldset>
        </div>
    </body>
</html>
